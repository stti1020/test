!function(){"use strict";angular.module("app",["ngRoute","restangular","emguo.poller","ngCookies"])}(),function(){"use strict";function e(e){e.when("/",{templateUrl:"app/components/landingPage/landingPage.html",controller:"LandingPageController as landingPageCtrl"}).when("/Map",{templateUrl:"app/components/map/map.html",controller:"MapController as mapCtrl",resolve:{allVehicles:["VehicleService",function(e){return e.fetchAllVehicles().then(function(e){return e})}],allRegistrationNumbersWithGeoposition:["MapService",function(e){return e.GetAllRegistrationNumbersWithGeoposition().then(function(e){return e})}]}}).when("/Profile",{templateUrl:"app/components/profile/profile.html",controller:"ProfileController as profileCtrl",resolve:{currentUser:["AuthenticationService",function(e){return e.getCurrentUser()}]}}).when("/VehicleManagement/createVehicle",{templateUrl:"app/components/vehicleManagement/createVehicle.html",controller:"CreateVehicleController as createVehicleCtrl",resolve:{allVehicleTypes:["VehicleTypeService",function(e){return e.fetchAllVehicleTypes().then(function(e){return e})}]}}).when("/VehicleManagement",{templateUrl:"app/components/vehicleManagement/showAllVehicles.html",controller:"ShowAllVehiclesController as showAllVehiclesCtrl",resolve:{allVehicles:["VehicleService",function(e){return e.fetchAllVehicles()}]}}).when("/VehicleManagement/showVehicle",{templateUrl:"app/components/vehicleManagement/showVehicle.html",controller:"ShowVehicleController as showVehicleCtrl",resolve:{vehicleWithPicture:["VehicleService",function(e){return e.fetchVehicleById(e.getVehicle().Id)}]}}).when("/VehicleManagement/updateVehicle",{templateUrl:"app/components/vehicleManagement/updateVehicle.html",controller:"UpdateVehicleController as updateVehicleCtrl",resolve:{allVehicleTypes:["VehicleTypeService","VehicleService",function(e,t){return e.fetchAllVehicleTypes().then(function(e){return t.fetchVehicleById(t.getVehicle().Id),e})}]}}).when("/TourManagement",{templateUrl:"app/components/tourManagement/showAllTours.html",controller:"ShowAllToursController as showAllToursCtrl",resolve:{allToursByDateRange:["TourService",function(e){{var t=new Date,n=(new Date("July 21, 1983 01:15:00"),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate());t.getFullYear()+"-"+(t.getMonth()+1)+"-"+(t.getDate()+1)}return e.fetchAllToursByDateRange(n,n).then(function(e){return e})}]}}).when("/TourManagement/createAndUpdateTour/:update?/:tourOrSeries?",{templateUrl:"app/components/tourManagement/createAndUpdateTour.html",controller:"CreateAndUpdateTourController as createAndUpdateTourCtrl",resolve:{allVehicles:["VehicleService",function(e){return e.fetchAllVehicles().then(function(e){return e})}],allRoutes:["RouteService",function(e){return e.fetchAllRoutes().then(function(e){return e})}]}}).when("/RouteManagement",{templateUrl:"app/components/routeManagement/showAllRoutes.html",controller:"ShowAllRoutesController as showAllRoutesCtrl",resolve:{allRoutes:["RouteService",function(e){return e.fetchAllRoutes().then(function(e){return e})}]}}).when("/RouteManagement/createAndUpdateRoute/:update?",{templateUrl:"app/components/routeManagement/createAndUpdateRoute.html",controller:"CreateAndUpdateRouteController as createAndUpdateRouteCtrl"}).when("/Profile",{templateUrl:"app/components/profile/profile.html",controller:"ProfileController as profileCtrl",resolve:{currentUser:["AuthenticationService",function(e){return e.fetchCurrentUser().then(function(e){return e})}]}}).otherwise({redirectTo:"/"})}angular.module("app").config(e),e.$inject=["$routeProvider"]}(),function(){"use strict";function e(){return function(e,t){if(void 0===t)return e;var n,r=[];return"Nein"===t||"Ja"===t?("Ja"===t&&(n=!0),"Nein"===t&&(n=!1),angular.forEach(e,function(e){(e.Done===n||e.Name.includes(t))&&r.push(e)})):angular.forEach(e,function(e){e.Name.includes(t)&&r.push(e)}),r}}angular.module("app").filter("showAllToursFilter",e),e.$inject=[]}(),function(){"use strict";function e(e){function t(e,t,n){var r=0;t.find("> *").each(function(){angular.element(this)[0].offsetHeight>r&&(r=r=angular.element(this)[0].offsetHeight)}),t.find("> *").each(function(){angular.element(this).css("height",r+"px")})}var n={link:t,restrict:"A"};return n}angular.module("app").directive("adjustContainerChildHeight",e),e.$inject=["$window"]}()(function(){"use strict";angular.module("app").directive("autofill",function(){return{require:"ngModel",link:function(e,t,n,r){e.$on("autofill:update",function(){r.$setViewValue(t.val())})}}})})(),function(){"use strict";function e(e){function t(e,t,n){}var n={link:t,restrict:"EA"};return n}angular.module("app").directive("dropzoneDirective",e),e.$inject=["$window"]}(),function(){"use strict";function e(e){function t(e,t,n){var r={imageFile:null,image:new Image,scale:1,click:!1,baseX:0,baseY:0,lastPointX:0,lastPointY:0,windowHeight:0,windowWidth:0,cutoutWidth:0,canvasCtx:document.getElementById("panel").getContext("2d"),init:function(){document.getElementById("uploadCanvas").onclick=this.uploadCanvasAsImage.bind(this),document.getElementById("scaleSlider").onmousemove=this.updateScale.bind(this),document.getElementById("file").onchange=function(e){if(this.imageFile=e.target.files[0],document.getElementById("scaleSlider").value=1,this.baseX=0,this.baseY=0,this.lastPointX=0,this.lastPointY=0,this.imageFile=e.target.files[0],null===this.imageFile)return swal("Keine Datei ausgewählt!","","error");if("image/jpeg"!==this.imageFile.type&&"image/png"!==this.imageFile.type&&"image/gif"!==this.imageFile.type&&"image/bmp"!==this.imageFile.type)return this.imageFile=null,swal("Falscher Dateityp! Bilder muss einer der Dateitypen: jpeg, png, gif, bmp sein!","","error");if(this.imageFile.size>=8388608)return swal("Dateigröße muss kleiner 8mb sein!!","","error");document.getElementById("canvasContainer").className="";var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){this.drawImageOnCanvas(t),this.canvasCtx.canvas.onmousedown=this.onMouseDown.bind(this),this.canvasCtx.canvas.onmousemove=this.onMouseMove.bind(this),this.canvasCtx.canvas.onmouseup=this.onMouseUp.bind(this)}.bind(this),t.src=e.target.result}.bind(this),t.readAsDataURL(this.imageFile)}.bind(this)},drawImageOnCanvas:function(e){this.image=e,this.canvasCtx.canvas.width=e.width,this.canvasCtx.canvas.height=e.height,this.canvasCtx.drawImage(e,0,0),this.drawCutout()},drawimage:function(e,t){var n=this.canvasCtx.canvas.width,r=this.canvasCtx.canvas.height;this.canvasCtx.clearRect(0,0,n,r),this.baseX=this.baseX+(e-this.lastPointX),this.baseY=this.baseY+(t-this.lastPointY),this.lastPointX=e,this.lastPointY=t,this.canvasCtx.drawImage(this.image,this.baseX,this.baseY,Math.floor(this.image.width*this.scale),Math.floor(this.image.height*this.scale)),this.drawCutout()},drawCutout:function(){this.cutoutWidth=.08*this.canvasCtx.canvas.width,this.windowWidth=this.canvasCtx.canvas.width-2*this.cutoutWidth,this.windowHeight=this.canvasCtx.canvas.height-2*this.cutoutWidth,this.canvasCtx.fillStyle="rgba(128, 128, 128, 0.7)",this.canvasCtx.beginPath(),this.canvasCtx.rect(0,0,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height),this.canvasCtx.moveTo(this.cutoutWidth,this.cutoutWidth),this.canvasCtx.lineTo(this.cutoutWidth,this.windowHeight+this.cutoutWidth),this.canvasCtx.lineTo(this.cutoutWidth+this.windowWidth,this.cutoutWidth+this.windowHeight),this.canvasCtx.lineTo(this.cutoutWidth+this.windowWidth,this.cutoutWidth),this.canvasCtx.closePath(),this.canvasCtx.fill()},onMouseDown:function(e){e.preventDefault();var t=this.windowToCanvas(e.clientX,e.clientY);this.click=!0,this.lastPointX=t.x,this.lastPointY=t.y},onMouseMove:function(e){if(e.preventDefault(),this.click){var t=this.windowToCanvas(e.clientX,e.clientY);this.drawimage(t.x,t.y)}},onMouseUp:function(e){e.preventDefault(),this.click=!1},windowToCanvas:function(e,t){var n=this.canvasCtx.canvas,r=n.getBoundingClientRect();return{x:e-r.left*(n.width/r.width),y:t-r.top*(n.height/r.height)}},updateScale:function(e){console.log("updateScale"),console.log(e),this.scale=e.target.value,this.drawimage(this.lastPointX,this.lastPointY)},canvasToBlob:function(t){t.width=this.windowWidth,t.height=this.windowHeight,this.canvasCtx.drawImage(this.image,this.baseX-this.cutoutWidth,this.baseY-this.cutoutWidth,Math.floor(this.image.width*this.scale),Math.floor(this.image.height*this.scale));var r=t.toDataURL(),i=r.search(",");r=r.substring(i+1,r.length),"profile"===n.mode?e.profileCtrl.saveProfilePicture(r):"updateVehicle"===n.mode?e.updateVehicleCtrl.createPicture(r):e.createVehicleCtrl.createPicture(r)},uploadCanvasAsImage:function(){this.canvasToBlob(this.canvasCtx.canvas)}};r.init(),e.discardChanges=function(){document.getElementById("file").value=null,document.getElementById("canvasContainer").className="hidden"}}var n={link:t,restrict:"EA",templateUrl:"app/directives/templates/imageUpload.html"};return n}angular.module("app").directive("imageUpload",e),e.$inject=["$window"]}(),function(){"use strict";function e(e){function t(){return e.all("/controllers/account/").customGET("GetCurrentUser").then(function(e){return o=e})}function n(){return o}function r(e){this.currentUser=e}function i(){return e.all("/controllers/account/").customPOST({name:""},"LogOff")}var o,a={getCurrentUser:n,setCurrentUser:r,fetchCurrentUser:t,logout:i};return a}angular.module("app").factory("AuthenticationService",e),e.$inject=["Restangular"]}(),function(){"use strict";function e(e,t){function n(e){var n=t.get("/api/map/GetLatestGeopositionByRegistrationNumber",{delay:6e3,action:"jsonp",argumentsArray:[{registrationNumber:e}]});return n}function r(){var e=t.get("/api/map/GetAllLatestGeopositions",{delay:6e3});return e}function i(n){var r="";0!==n.length&&(r=JSON.stringify(n));var i=t.get(e.one("/api/map/GetLatestGeopositionByRegistrationNumbers"),{action:"get",delay:6e3,argumentsArray:[{registrationNumbers:r}]});return i}function o(){return e.all("/api/map/GetAllRegistrationNumbersWithGeoposition").getList().then(function(e){return s=e})}function a(t){return e.all("/api/map").customGET("GetAllGeopositionsByRegistrationNumber",{registrationNumber:t})}function l(t){return e.all("/api/map").customGET("GetGeopositionsForSimulationByRegistrationNumber",{registrationNumber:t})}var s,c={GetLatestGeopositionByRegistrationNumber:n,GetAllLatestGeopositions:r,GetLatestGeopositionByRegistrationNumbers:i,GetAllRegistrationNumbersWithGeoposition:o,GetAllGeopositionsByRegistrationNumber:a,GetGeopositionsForSimulationByRegistrationNumber:l};return c}angular.module("app").factory("MapService",e),e.$inject=["Restangular","poller"]}(),function(){"use strict";function e(){function e(e){V=null,V=new google.maps.Map(e,{mapTypeId:google.maps.MapTypeId.TERRAIN,zoom:13}),$(e).animate({width:"auto"},function(){google.maps.event.trigger(V,"resize")})}function t(e,t){C=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(e,t)})}function n(e,t){C.setContent(e),C.setPosition(t),C.open(V)}function r(e,t){R=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(e,t)})}function i(){b=new google.maps.InfoWindow}function o(){return M=new MarkerClusterer(V)}function a(e,t,n){var r=new google.maps.Marker({position:{lat:e,lng:t},map:V,title:n,icon:"images/TruckIcon.png"});return r}function l(){google.maps.event.addListener(M,"mouseover",function(e){R.setPosition(e.getCenter());var t="";angular.forEach(e.getMarkers(),function(e){t=t+"<div>"+e.title+"</div> "}),R.setContent(t),R.open(V)})}function s(){google.maps.event.addListener(M,"mouseout",function(){R.close(V)})}function c(){google.maps.event.addListener(M,"click",function(){R.close(V)})}function u(e,t){google.maps.event.addListener(e,"mouseover",function(){C.setPosition(e.getPosition()),C.setContent(t),C.open(V)})}function d(e){google.maps.event.addListener(e,"mouseout",function(){N||C.close(V)})}function h(e){google.maps.event.addListener(e,"click",function(){N=!N})}function g(){google.maps.event.addListener(V,"zoom_changed",function(){C.close(V),N=!1})}function f(){return N()}function p(e){N=e}function m(e){var t=new google.maps.LatLngBounds;angular.forEach(e,function(e){t.extend(new google.maps.LatLng(e.latitude,e.longitude))}),V.setCenter(t.getCenter()),V.fitBounds(t),V.getZoom()>16&&V.setZoom(16)}function v(){I=new google.maps.DirectionsService}function w(e,t,n,r){var i=[];angular.forEach(t.Waypoints,function(e){i.push({location:e.Name})});var o={origin:t.StartName,destination:t.DestinationName,travelMode:google.maps.TravelMode.DRIVING,waypoints:i};return I.route(o,function(t,i){if(i===google.maps.DirectionsStatus.OK){var a=new google.maps.DirectionsRenderer;a.setDirections(t);var l=S(t.routes[0].legs,e,n);e.push({vehicleId:r,directionsDisplays:a,data:o,poly:l}),y(e)}}),e}function S(e,t,n){for(var r=Array(),i=0;i<e.length;i++)for(var o=0;o<e[i].steps.length;o++)for(var a=0;a<e[i].steps[o].path.length;a++)r.push(e[i].steps[o].path[a]);var l={strokeWeight:"7",strokeColor:P.colors[t.length]},s={strokeWeight:"5",strokeColor:P.colors[t.length]},c=new google.maps.Polyline(s);return c.setPath(r),c.setMap(V),google.maps.event.addListener(c,"mouseover",function(e){c.setOptions(l),b.setPosition(e.latLng.toJSON()),b.setContent("<div>Kennzeichen: "+n+"</div>"),b.open(V)}),google.maps.event.addListener(c,"mouseout",function(){c.setOptions(s),b.close(V)}),c}function y(e){var t=new google.maps.LatLngBounds;angular.forEach(e,function(e){angular.forEach(e.directionsDisplays.directions.routes[0].legs,function(e){t.extend(new google.maps.LatLng(e.start_location.lat(),e.start_location.lng()))})}),V.setCenter(t.getCenter()),V.fitBounds(t),V.getZoom()>16&&V.setZoom(16)}function D(e){V.setCenter(e)}function T(){google.maps.event.trigger(V,"resize")}var V,I,C,R,b,M,P;$.getJSON("app/components/map/colors.json",function(e){P=e});var N=!1,B={setMap:e,setMarkerInfoWindow:t,setMarkerInfoWindowToMap:n,setClusterInfoWindow:r,setDirectionInfoWindow:i,setMarkerClusterer:o,setMarker:a,setMouseoverListenerForMarkerClusterer:l,setMouseOutListenerForMarkerClusterer:s,setClickListenerForMarkerClusterer:c,setMouseoverListenerForMarker:u,setZoomChangedListenerForMap:g,setMouseoutListenerForMarker:d,setClickListenerForMaker:h,getMarkerIsClicked:f,setMarkerIsClicked:p,setBound:m,setDirectionService:v,setMapCenter:D,setDirectionForMapController:w,resizeMap:T,setCenterOfPolylines:y};return B}angular.module("app").factory("MapGoogleAbstractService",e),e.$inject=[]}(),function(){"use strict";function e(e,t){function n(t){return e.all("api/user/").customPUT({name:""},"UpdateUser",{Id:t.Id,FirstName:t.FirstName,LastName:t.LastName})}function r(t){return e.all("api/user/").customDELETE("DeleteUser",{Id:t.Id})}function i(n){return t.setCurrentUser(n),e.all("api/user/").customPUT({Picture:n.ProfilePicture},"UpdateProfilePicture",{Id:n.Id})}var o={saveProfileChanges:n,deleteProfile:r,saveProfilePicture:i};return o}angular.module("app").factory("ProfileService",e),e.$inject=["Restangular","AuthenticationService"]}(),function(){"use strict";function e(e){function t(){return e.all("/api/property/GetAllProperties").getList()}var n={getAllProperties:t};return n}angular.module("app").factory("PropertyService",e),e.$inject=["Restangular"]}(),function(){"use strict";function e(e,t,n,r){function i(t,n){var i=JSON.stringify({Route:t,RouteWaypoints:n});return e.all("/api/route").customPOST({name:""},"CreateOrUpdateRoute",{json:i}).then(function(e){e===!0?(swal("Erfolgreich gespeichrt!","","success"),r.path("/RouteManagement")):swal("Interner Serverfehler!","","error")},function(e){swal("Interner Serverfehler!","","error")})}function o(t){swal({title:"Soll diese Route wirklich gelöscht werden?",text:"Die Route kann nicht wiederhergestellt werden",type:"warning",showCancelButton:!0,cancelButtonText:"Abbrechen",confirmButtonColor:"#DD6B55",confirmButtonText:"Löschen",closeOnConfirm:!1},function(){return e.all("api/route").customDELETE("DeleteRouteById",{id:t}).then(function(e){e===!0?swal({title:"Erfolgreich gelöscht!",type:"success",confirmButtonText:"OK",closeOnConfirm:!1},function(){window.location.reload()}):swal("Interner Serverfehler!","","error")},function(e){swal("Interner Serverfehler!","","error")})})}function a(){return e.all("/api/route/GetAllRoutes").getList().then(function(e){return c=e})}function l(){return(_.isEmpty(u)||_.isUndefined(u))&&(u=t.getObject("selectedRoute")),u}function s(e){u=e}var c,u,d={createRoute:i,deleteRouteById:o,fetchAllRoutes:a,getRoute:l,setRoute:s};return d}angular.module("app").factory("RouteService",e),e.$inject=["Restangular","$cookies","$http","$location"]}(),function(){"use strict";function e(e,t,n,r){function i(t){swal({title:"Soll diese Tour wirklich gelöscht werden?",text:"Die Tour kann nicht wiederhergestellt werden.",type:"warning",showCancelButton:!0,cancelButtonText:"Abbrechen",confirmButtonColor:"#DD6B55",confirmButtonText:"Löschen",closeOnConfirm:!1},function(){return e.all("api/tour").customDELETE("DeleteTourById",{id:t}).then(function(e){e===!0?swal({title:"Erfolgreich gelöscht!",type:"success",confirmButtonText:"OK",closeOnConfirm:!1},function(){window.location.reload()}):swal("Interner Serverfehler!","","error")},function(e){swal("Interner Serverfehler!","","error")})})}function o(t){swal({title:"Soll diese Tourserie wirklich gelöscht werden?",text:"Die Tourserie kann nicht wiederhergestellt werden",type:"warning",showCancelButton:!0,cancelButtonText:"Abbrechen",confirmButtonColor:"#DD6B55",confirmButtonText:"Löschen",closeOnConfirm:!1},function(){return e.all("api/tourSeries").customDELETE("DeleteTourSeriesById",{id:t}).then(function(e){e===!0?swal({title:"Erfolgreich gelöscht!",type:"success",confirmButtonText:"OK",closeOnConfirm:!1},function(){window.location.reload()}):swal("Interner Serverfehler!","","error")},function(e){swal("Interner Serverfehler!","","error")})})}function a(t,n){return e.all("/api/tour").customGET("GetAllToursByDateRange",{rangeFrom:t,rangeTo:n})}function l(t,n,i){var o=JSON.stringify({Tour:t,TourSeries:n,VehicleIds:i});return e.all("/api/tour").customPOST({name:""},"CreateAndUpdateTour",{json:o}).then(function(e){e===!0?(swal("Erfolgreich gespeichert!","","success"),r.path("/TourManagement")):swal("Interner Serverfehler!","","error")},function(e){swal("Interner Serverfehler!","","error")})}function s(){return(_.isEmpty(g)||_.isUndefined(g))&&(g=t.getObject("selectedTour")),g}function c(e){g=e}function u(e){var t=String(e),n=t.split(".");return n[2]+"-"+n[1]+"-"+n[0]}function d(e){var t=new Date(e),n=t.getDate(),r=t.getMonth()+1;9>=n&&(n="0"+n),9>=r&&(r="0"+r);var i=n+"."+r+"."+t.getFullYear();return i}function h(t){return e.all("api/tour").customGET("GetCurrentTourByVehicleId",{vehicleId:t})}var g,f={fetchAllToursByDateRange:a,createAndUpdateTour:l,setTour:c,getTour:s,convertGermanDateStringToDate:u,convertDateToGermanDateString:d,getCurrentTourByVehicleId:h,deleteTourById:i,deleteTourSeriesById:o};return f}angular.module("app").factory("TourService",e),e.$inject=["Restangular","$cookies","$http","$location"]}(),function(){"use strict";function e(){function e(e){f=new google.maps.Map(e,V),google.maps.event.addListener(f,"idle",function(){google.maps.event.trigger(f,"resize")})}function t(e){p=new google.maps.Map(e,V),google.maps.event.addListener(p,"idle",function(){google.maps.event.trigger(p,"resize")})}function n(e){w=new google.maps.DirectionsService,m=e?new google.maps.DirectionsRenderer({draggable:!0}):new google.maps.DirectionsRenderer,m.setMap(f)}function r(e){S=new google.maps.DirectionsService,v=e?new google.maps.DirectionsRenderer({draggable:!0}):new google.maps.DirectionsRenderer,v.setMap(p)}function i(){y=new google.maps.Geocoder}function o(e){w.route(D,function(t,n){n==google.maps.DirectionsStatus.OK&&(m.setDirections(t),e(t))})}function a(){w.route(D,function(e,t){t==google.maps.DirectionsStatus.OK&&m.setDirections(e)})}function l(e){S.route(D,function(t,n){n==google.maps.DirectionsStatus.OK&&(v.setDirections(t),e(t.routes[0].legs))})}function s(e,t){var n=new google.maps.LatLngBounds;angular.forEach(e,function(e){var t=new google.maps.LatLng(e.start_location.lat(),e.start_location.lng());n.extend(t)});var r=new google.maps.LatLng(n.getCenter().lat(),n.getCenter().lng());t?(p.setCenter(r),google.maps.event.trigger(p,"resize")):(f.setCenter(r),google.maps.event.trigger(f,"resize"))}function c(e,t,n){return D="undefined"===n?{origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING}:{origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING,waypoints:n}}function u(){return m.directions.routes[0].legs[0].via_waypoints}function d(){return m.directions.request.waypoints}function h(e,t,n,r){new google.maps.places.Autocomplete(e),new google.maps.places.Autocomplete(t),new google.maps.places.Autocomplete(n),new google.maps.places.Autocomplete(r)}function g(e,t,n){y.geocode({location:e},function(e,r){t.resolve(e[0].formatted_address),n(t)})}var f,p,m,v,w,S,y,D,T=new google.maps.LatLng(49.007862,8.40366),V={zoom:12,center:T},I={setMap:e,setSecondMap:t,setDirectionService:n,setSecondDirectionService:r,setGeocode:i,setDirectionsWithCallback:o,setDirectionsWithoutCallback:a,setDirectionsForSecondMap:l,buildRouteObject:c,getViaWaypoints:u,getWaypointsToAdd:d,setAutocompletion:h,useGeocoder:g,setCenter:s};return I}angular.module("app").factory("TourAndRouteGoogleAbstractService",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n){function r(){return y}function i(e){y=e}function o(t){return e.all("api/vehicle").customGET("GetVehicleByRegistrationNumber",{registrationNumber:t}).then(function(e){i(e)})}function a(){return e.all("/api/vehicle/GetAllVehicles").getList().then(function(e){return w=e})}function l(){return w}function s(){return(_.isEmpty(S)||_.isUndefined(S))&&(S=t.getObject("selectedVehicle")),S}function c(e){S=e}function u(e){S.Properties=e}function d(e){S.VehicleTypeId=e}function h(t){return e.all("/api/vehicle").customGET("GetVehicleById",{id:t}).then(function(e){S.Picture=e.Picture})}function g(t){for(var n=[],r=[],i=0;i<t.Properties.length;i++)n.push(t.Properties[i].PropertyId),r.push(t.Properties[i].Value);var o=JSON.stringify({PropertyIds:n,Values:r});return e.all("/api/vehicle").customPUT({name:""},"UpdateVehicle",{id:t.Id,registrationNumber:t.RegistrationNumber,vehicleTypeId:t.VehicleTypeId,vehiclePropertiesJson:o})}function f(t){for(var n=[],r=[],i=0;i<t.Properties.length;i++)n.push(t.Properties[i].PropertyId),r.push(t.Properties[i].Value);var o=JSON.stringify({RegistrationNumber:t.RegistrationNumber,VehicleTypeId:t.VehicleTypeId,PropertyIds:n,Values:r});return e.all("/api/vehicle").customPOST({name:""},"CreateVehicle",{createVehicleJson:o})}function p(t){return e.all("/api/vehicle").customGET("GetAllVehiclePropertiesByVehicleId",{vehicleId:t})}function m(t){swal({title:"Soll dieses Fahrzeug wirklich gelöscht werden?",text:"Das Fahrzeug kann nicht wiederhergestellt werden.",type:"warning",showCancelButton:!0,cancelButtonText:"Abbrechen",confirmButtonColor:"#DD6B55",confirmButtonText:"Löschen",closeOnConfirm:!1},function(){return e.all("api/vehicle").customDELETE("DeleteVehicleById",{id:t}).then(function(e){e===!0?(swal("Erfolgreich gelöscht!","","success"),n.path("/VehicleManagement")):swal("Interner Serverfehler!","","error")},function(e){swal("Interner Serverfehler!","","error")})})}function v(t){return e.all("api/vehicle/").customPUT({Picture:t.Picture},"UpdatePicture",{id:t.Id})}var w,S,y,D={fetchAllVehicles:a,fetchVehicleById:h,fetchAllVehiclePropertiesByVehicleId:p,deleteVehicleById:m,updateVehicle:g,createVehicle:f,getAllVehicles:l,getVehicle:s,setVehicle:c,setVehicleProperties:u,setVehicleTypeId:d,getVehicleWithRegistrationNumber:r,savePicture:v,fetchVehicleWithRegistrationNumber:o};return D}angular.module("app").factory("VehicleService",e),e.$inject=["Restangular","$cookies","$location"]}(),function(){"use strict";function e(e){function t(){return e.all("/api/VehicleType/getAllVehicleTypes").getList()}var n={fetchAllVehicleTypes:t};return n}angular.module("app").factory("VehicleTypeService",e),e.$inject=["Restangular"]}(),function(){"use strict";function e(){var e=this;e.elements=[{name:"Echtzeitkarte",imageSource:"images/EchtzeitKartenansichts_Beispiel.PNG",href:"Map"},{name:"Fahrzeugverwaltung",imageSource:"images/Fahrzeugverwaltung_Beispiel.PNG",href:"VehicleManagement"},{name:"Tourenverwaltung",imageSource:"images/Tourenverwaltung_Beispiel.PNG",href:"TourManagement"},{name:"Routenverwaltung",imageSource:"images/Tourenverwaltung_Beispiel.PNG",href:"RouteManagement"},{name:"Profilverwaltung",imageSource:"images/Benutzerverwaltung_BeispielPNG.PNG",href:"Profile"}]}angular.module("app").controller("LandingPageController",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n,r,i,o){function a(e){S.simulationDropdown=e}function l(){S.simulationStarted=!0,"Kennzeichen auswählen"!==S.simulationDropdown?(A.stop(),P(),b.clearMarkers(),t.GetGeopositionsForSimulationByRegistrationNumber(S.simulationDropdown).then(function(e){e.reverse();var n;!function r(i){i<e.length?setTimeout(function(){P(),n=o.setMarker(e[i].latitude,e[i].longitude,e[i].registrationNumber),y.push(n);var t="<div> Kennzeichen: "+e[i].registrationNumber+"</div>";angular.forEach(e[i].obdPropertyList,function(e){t="INVALID"===e.result?t+"<div>"+e.property+": "+e.result+"</div>":t+"<div>"+e.property+" "+e.result+" "+e.unit+"</div>"}),o.setMarkerInfoWindowToMap(t,n.getPosition());var a={lat:e[i].latitude,lng:e[i].longitude};o.setMapCenter(a),r(++i)},900):i===e.length&&(S.simulationStarted=!1,A=t.GetLatestGeopositionByRegistrationNumbers(D),V=!1)}(0)},function(e){404===e.status&&(swal("Simulation konnte nicht gestartet werden!","Es sind keine Geodaten zu diesem Fahrzeug in der Datenbank enthalten.","error"),S.simulationStarted=!1)})):(swal("Simulation konnte nicht gestartet werden!","Um die Simulation zu starten muss ein Fahrzeug ausgewählt werden.","error"),S.simulationStarted=!1)}function s(e){return S.allRegistrationNumbersWithGeoposition.indexOf(e)>-1&&!S.simulationStarted?"pointer":"not-allowed"}function c(){S.filterValue=$("#vehicleFilter").val()}function u(){if(!S.simulationStarted){if(""===S.filterValue||null===S.filterValue||void 0===S.filterValue)D.length<S.allRegistrationNumbersWithGeoposition.length?(D.splice(0,D.length),D.push.apply(D,S.allRegistrationNumbersWithGeoposition)):D.splice(0,D.length);else for(var e=0;e<S.allVehicles.length;e++)if(S.allVehicles[e].RegistrationNumber.toUpperCase().includes(S.filterValue.toUpperCase())||S.allVehicles[e].VehicleType.Name.toUpperCase().includes(S.filterValue.toUpperCase())){for(var n=!1,o=!1,a=0;a<D.length;a++)if(D[a]===S.allVehicles[e].RegistrationNumber){n=!0;break}for(var l=0;l<i.length;l++)if(i[l]===S.allVehicles[e].RegistrationNumber){o=!0;break}!n&&o?D.push(r[e].RegistrationNumber):n&&o&&D.splice(D.indexOf(r[e].RegistrationNumber),1)}A=t.GetLatestGeopositionByRegistrationNumbers(D),V=!1}}function d(e){return S.allRegistrationNumbersWithGeoposition.indexOf(e)>-1?!1:!0}function h(){S.showConfig===!0?($(R).animate({width:"auto"},function(){o.resizeMap(),B(I)}),S.showConfig=!1,S.mapWidth="col-lg-12",S.showConfigIcon="Fahrzeugauswahl anzeigen"):(S.showConfig=!0,S.mapWidth="col-lg-8",S.showConfigIcon="Fahrzeugauswahl ausblenden",$(R).animate({width:"auto"},function(){o.resizeMap(),B(I)}))}function g(e){D.indexOf(e)>-1?D.splice(D.indexOf(e),1):D.push(e),A=t.GetLatestGeopositionByRegistrationNumbers(D),V=!1}function f(e,t){return D.indexOf(t)>-1||A.length===S.allRegistrationNumbersWithGeoposition.length?!0:!1}function p(e,t){var n=!1;0===T.length?E(t,e):(angular.forEach(T,function(t,r){t.vehicleId===e&&(n=!0,t.directionsDisplays.setDirections({routes:[]}),t.poly.setMap(null),T.splice(r,1),0!=T.length&&o.setCenterOfPolylines(T))}),n||E(t,e))}function m(e){return-1===D.indexOf(e)?!0:!1}function v(e,t){return-1!==D.indexOf(e)?!1:void angular.forEach(T,function(e,n){return e.vehicleId===t?(e.directionsDisplays.setDirections({routes:[]}),e.poly.setMap(null),T.splice(n,1),0!=T.length&&o.setCenterOfPolylines(T),!1):void 0})}function w(e){return-1===C.indexOf(e)?!1:!0}var S=this,y=[],D=[],T=[],V=!1,I=null,C=[],R=document.getElementById("googleMap");o.setDirectionService(),o.setMap(R),o.setMarkerInfoWindow(0,-30),o.setClusterInfoWindow(0,-10),o.setDirectionInfoWindow();var b=o.setMarkerClusterer(),M=[{textColor:"white",textSize:20,url:"images/cluster1.png",height:35,width:35}];S.allVehicles=r,S.allRegistrationNumbersWithGeoposition=i,S.showConfig=!0,S.mapWidth="col-lg-8",S.showConfigIcon="Fahrzeugauswahl ausblenden",S.resizeMapWidth=h,S.filter={id:""},S.filterValue,S.filterValueChanged=c,S.orderByField="Kennzeichen",S.reverseSort=!1,S.changeShowRegistrationNumber=g,S.checkedRegistrationNumber=f,S.stateCheckbox=d,S.selectRegistrationNumbersWithGeoposition=u,S.checkBoxCursor=s,S.startSimulation=l,S.simulationStarted=!1,S.simulationDropdown="Kennzeichen auswählen",S.selectSimulationRegistrationNumber=a,S.showTourOfSelectedVehicle=p,S.checkIfVehicleIsSelected=m,S.uncheckVehicleIfTourIsSelected=v,S.checkIfVehicleHasNoTour=w,o.setMouseoverListenerForMarkerClusterer(),o.setMouseOutListenerForMarkerClusterer(),o.setClickListenerForMarkerClusterer();var P=function(e){for(;y.length;)y.pop().setMap(null)};o.setZoomChangedListenerForMap();var N=function(e){angular.forEach(e,function(e){var t=o.setMarker(e.latitude,e.longitude,e.registrationNumber);o.setMarkerIsClicked(!1);var n="<div> Kennzeichen: "+e.registrationNumber+"</div>";angular.forEach(e.obdPropertyList,function(e){n="INVALID"===e.result?n+"<div>"+e.property+": "+e.result+"</div>":n+"<div>"+e.property+" "+e.result+" "+e.unit+"</div>"}),o.setMouseoverListenerForMarker(t,n),o.setMouseoutListenerForMarker(t),o.setClickListenerForMaker(t),y.push(t)})},B=function(e){o.setBound(e),V=!0,I=e},A=t.GetLatestGeopositionByRegistrationNumbers(S.allRegistrationNumbersWithGeoposition);A.promise.then(null,null,function(t){"/Map"!==e.path()&&A.remove(),P(),b.clearMarkers(),V||(B(t),b.setOptions({gridSize:50,styles:M,maxZoom:19})),N(t),b.addMarkers(y)});var E=function(e,t){n.getCurrentTourByVehicleId(t).then(function(n){T=o.setDirectionForMapController(T,n,e,t)},function(e){404===e.status&&(swal("Dem Fahrzeug ist heute keine Tour zugeordnet!","","error"),C.push(t))})}}angular.module("app").controller("MapController",e),e.$inject=["$location","MapService","TourService","allVehicles","allRegistrationNumbersWithGeoposition","MapGoogleAbstractService"]}(),function(){"use strict";function e(e,t,n,r){function i(t){return e.path().substr(0,t.length)===t?"active":""}function o(){t.logout().then(function(e){n.location.reload()})}var a=this;a.getIfActive=i,a.logout=o,a.currentUser,t.fetchCurrentUser().then(function(e){a.currentUser=e}),r.$watch(function(){return t.currentUser},function(e,t){a.currentUser=e},!0)}angular.module("app").controller("NavigationController",e),e.$inject=["$location","AuthenticationService","$window","$scope"]}(),function(){"use strict";function e(e,t,n,r){function i(){document.getElementById("firstnameInput").focus(),c.profileEditable=!0,u=angular.copy(c.user)}function o(){c.profileEditable=!1,c.user=u}function a(){return t.saveProfileChanges(c.user).then(function(e){void 0!==e||null!==e?(c.user=e,r.setCurrentUser(e),c.profileEditable=!1,swal("Erfolgreich gespeichrt!","","success")):swal("Interner Serverfehler!","","error")})}function l(){swal({title:"Soll dieses Profil wirklich gelöscht werden?",text:"Das Profil kann nicht wiederhergestellt werden.",type:"warning",showCancelButton:!0,cancelButtonText:"Abbrechen",confirmButtonColor:"#DD6B55",confirmButtonText:"Löschen",closeOnConfirm:!1},function(){return t.deleteProfile(c.user).then(function(e){r.logout().then(function(e){n.location.reload()})})})}function s(e){return c.user.ProfilePicture=e,t.saveProfilePicture(c.user).then(function(e){c.user=e,r.setCurrentUser(e),c.profileEditable=!1}).then(function(){document.getElementById("canvasContainer").className="hidden",
document.getElementById("file").value=null})}var c=this,u=null;c.message=null,c.abortProfileChanges=o,c.profileEditable=!1,c.editProfile=i,c.deleteProfile=l,c.saveProfileChanges=a,c.user=e,c.saveProfilePicture=s}angular.module("app").controller("ProfileController",e),e.$inject=["currentUser","ProfileService","$window","AuthenticationService"]}(),function(){"use strict";function e(e,t,n,r,i,o){function a(){var e=document.getElementById("source"),t=document.getElementById("destination"),n=document.getElementById("sourceAndDestination"),r=document.getElementById("waypoint");o.setAutocompletion(e,t,n,r)}function l(){if(r.$broadcast("autofill:update"),"different"===g.createMode)o.buildRouteObject(g.source,g.destination);else{var e=[];e.push({location:g.waypoint}),o.buildRouteObject(g.sourceAndDestination,g.sourceAndDestination,e)}o.setDirectionsWithoutCallback()}function s(){if("different"===g.createMode){var e=o.getViaWaypoints(),r=o.getWaypointsToAdd(),i=[],a=[];angular.forEach(r,function(e){_.isString(e.location)&&a.push({location:e.location})}),angular.forEach(e,function(e){var t={lat:e.lat(),lng:e.lng()},n=h(t);i.push(n)}),n.all(i).then(function(e){angular.forEach(e,function(e){a.push({location:e})});var n=0;if(g.update){var r=void 0,i=void 0;r=_.isUndefined(g.source)||_.isNull(g.source)?g.route.StartName:g.source,i=_.isUndefined(g.destination)||_.isNull(g.destination)?g.route.DestinationName:g.destination;var l=o.buildRouteObject(r,i,a)}else var l=o.buildRouteObject(g.source,g.destination,a);o.setDirectionsWithCallback(function(e){if(null!==e||void 0!==e){n=u(e.routes[0].legs);var r=e.routes[0].legs;if(g.update)var i={Id:g.route.Id,StartName:e.request.origin,StartLongitude:e.routes[0].legs[0].start_location.lng(),StartLatitude:e.routes[0].legs[0].start_location.lat(),DestinationName:e.request.destination,DestinationLongitude:e.routes[0].legs[r.length-1].end_location.lng(),DestinationLatitude:e.routes[0].legs[r.length-1].end_location.lat(),Distance:n};else var i={StartName:g.source,StartLongitude:e.routes[0].legs[0].start_location.lng(),StartLatitude:e.routes[0].legs[0].start_location.lat(),DestinationName:g.destination,DestinationLongitude:e.routes[0].legs[r.length-1].end_location.lng(),DestinationLatitude:e.routes[0].legs[r.length-1].end_location.lat(),Distance:n};for(var o=[],a=0;a<r.length-1;a++)o.push({Name:r[a].end_address,Longitude:r[a].end_location.lng(),Latitude:r[a].end_location.lat()});return t.createRoute(i,o)}}),t.setRoute(l)})}else{var e=o.getWaypointsToAdd(),r=o.getWaypointsToAdd(),i=[],a=[];angular.forEach(r,function(e){_.isString(e.location)&&a.push({location:e.location})});for(var l=0;l<e.length;l++){if(_.isString(e[l].location))var s=d(e[l].location);else var c={lat:e[l].location.lat(),lng:e[l].location.lng()},s=h(c);i.push(s)}n.all(i).then(function(e){angular.forEach(e,function(e){a.push({location:e})});var n=0;if(g.update){var r=void 0;r=_.isUndefined(g.sourceAndDestination)||_.isNull(g.sourceAndDestination)?g.route.StartName:g.sourceAndDestination;var i=o.buildRouteObject(r,r,a)}else var i=o.buildRouteObject(g.sourceAndDestination,g.sourceAndDestination,a);o.setDirectionsWithCallback(function(e){if(null!==e||"undefined"!==e){n=u(e.routes[0].legs);var r=e.routes[0].legs;if(g.update)var i={Id:g.route.Id,StartName:e.request.origin,StartLongitude:e.routes[0].legs[0].start_location.lng(),StartLatitude:e.routes[0].legs[0].start_location.lat(),DestinationName:e.request.destination,DestinationLongitude:e.routes[0].legs[r.length-1].end_location.lng(),DestinationLatitude:e.routes[0].legs[r.length-1].end_location.lat(),Distance:n};else var i={StartName:g.sourceAndDestination,StartLongitude:e.routes[0].legs[0].start_location.lng(),StartLatitude:e.routes[0].legs[0].start_location.lat(),DestinationName:g.sourceAndDestination,DestinationLongitude:e.routes[0].legs[0].start_location.lng(),DestinationLatitude:e.routes[0].legs[0].start_location.lat(),Distance:n};for(var o=[],a=0;a<r.length-1;a++)o.push({Name:r[a].end_address,Longitude:r[a].end_location.lng(),Latitude:r[a].end_location.lat()});return t.createRoute(i,o)}}),t.setRoute(i)})}}function c(e){g.createMode=e}function u(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].distance.value;return t}function d(e){var t=n.defer();return t.resolve(e),t.promise}function h(e){var t=n.defer();return m.geocode({location:e},function(e,n){t.resolve(e[0].formatted_address)}),t.promise}var g=this;g.route=t.getRoute(),g.calculateRoute=l,g.destination=void 0,g.saveRoute=s,g.switchCreateMode=c,g.createMode=void 0,g.source=void 0,g.sourceAndDestination=void 0,g.update=!1,g.waypoint=void 0;var f=document.getElementById("routeMap");o.setMap(f);var p=!0;o.setDirectionService(p),o.setGeocode();var m=new google.maps.Geocoder;if(i.update){g.update=!0,g.createMode=g.route.StartName===g.route.DestinationName?"same":"different";var v=g.route.Waypoints,w=[];angular.forEach(v,function(e){w.push({location:e.Name})}),o.buildRouteObject(g.route.StartName,g.route.DestinationName,w),o.setDirectionsWithoutCallback()}a()}angular.module("app").controller("CreateAndUpdateRouteController",e),e.$inject=["$location","RouteService","$q","$scope","$routeParams","TourAndRouteGoogleAbstractService"]}(),function(){"use strict";function e(e,t,n,r,i){function o(){return t.deleteRouteById(s.route.Id).then(function(e){s.allRoutes=_.remove(s.allRoutes,function(e){return e!==s.route?e:void 0}),s.route=void 0},function(e){swal("Die Route konnte nicht gelöscht werden!","Vielleicht ist sie noch einer Tour zugeordnet?","error")})}function a(e,r){s.selected=r,s.route=e,t.setRoute(e),n.putObject("selectedRoute",e);var o=e.Waypoints,a=[];angular.forEach(o,function(e){a.push({location:e.Name})}),i.buildRouteObject(e.StartName,e.DestinationName,a),i.setDirectionsWithoutCallback()}function l(){s.route&&e.path("/RouteManagement/createAndUpdateRoute/true")}var s=this,c=document.getElementById("selectedRouteMap"),u=!1;i.setMap(c),i.setDirectionService(u),s.allRoutes=r,s.deleteRouteById=o,s.orderFieldBy="StartName",s.reverseSort=!1,s.route=void 0,s.selected=void 0,s.selectRoute=a,s.updateRoute=l}angular.module("app").controller("ShowAllRoutesController",e),e.$inject=["$location","RouteService","$cookies","allRoutes","TourAndRouteGoogleAbstractService"]}(),function(){"use strict";function e(e,t,n,r,i,o,a){function l(){P.currentVehicle=0===P.tourVehicles.length?"Keine Fahrzeuge ausgewählt!":P.tourVehicles[O].RegistrationNumber+" - "+P.tourVehicles[O].VehicleType.Name}function s(){0===O?O=P.tourVehicles.length-1:O>0&&O--,P.currentVehicle=P.tourVehicles[O].RegistrationNumber+" - "+P.tourVehicles[O].VehicleType.Name}function c(){O<P.tourVehicles.length-1?O++:O===P.tourVehicles.length-1&&(O=0),P.currentVehicle=P.tourVehicles[O].RegistrationNumber+" - "+P.tourVehicles[O].VehicleType.Name}function u(e){return _.isUndefined(P.selectedRoute)?"":e===P.selectedRoute.Id?"selected":void 0}function d(e){return _.isUndefined(e)||_.isNull(e)?void 0:1==e?"Ja":0==e?"Nein":void 0}function h(e){var t=!0;return x.indexOf(e)<0&&(t=!1),t}function g(e){x.indexOf(e.Id)<0?(x.push(e.Id),P.tourVehicles.push(e)):(x.splice(x.indexOf(e.Id),1),P.tourVehicles.splice(P.tourVehicles.indexOf(e),1)),l()}function f(e){P.selectedRoute=e;var t=e.Waypoints,n=[];angular.forEach(t,function(e){n.push({location:e.Name})}),a.buildRouteObject(e.StartName,e.DestinationName,n),k&&!o.update&&a.setDirectionsWithoutCallback(),F&&a.setDirectionsWithoutCallback(),G&&(G=!1)}function p(){P.selectedTourSeries=!P.selectedTourSeries}function m(){P.selectedDone=!P.selectedDone}function v(e){if("General"===e)U();else if("Route"===e){if(k||o.update){if(!k&&o.update){var t=document.getElementById("selectedRouteMap");a.setMap(t),a.setDirectionService(L),a.setDirectionsWithCallback(function(e){a.setCenter(e.routes[0].legs,!1)}),k=!0,F=!0}}else{var t=document.getElementById("selectedRouteMap");a.setMap(t),a.setDirectionService(L),k=!0}W()}else if("Vehicles"===e)z();else if(j(),void 0===P.selectedRoute&&G===!1){var n=document.getElementById("selectedSummaryMap");a.setSecondMap(n),G=!0}else if(!G){var n=document.getElementById("selectedSummaryMap");a.setSecondMap(n),a.setSecondDirectionService(L),a.setDirectionsForSecondMap(function(e){a.setCenter(e,!0)}),G=!0}}function w(){if("Summary"===P.selectedPage)P.selectedPage="Vehicles",z();else if("Vehicles"===P.selectedPage){if(k||o.update){if(!k&&o.update){var e=document.getElementById("selectedRouteMap");a.setMap(e),a.setDirectionService(L),a.setDirectionsWithCallback(function(e){a.setCenter(e,!1)}),k=!0,F=!0}}else{var e=document.getElementById("selectedRouteMap");a.setMap(e),a.setDirectionService(L),k=!0}P.selectedPage="Route",W()}else P.selectedPage="General",U()}function S(){if("General"===P.selectedPage){if(k||o.update){if(!k&&o.update){var e=document.getElementById("selectedRouteMap");a.setMap(e),a.setDirectionService(L),a.setDirectionsWithCallback(function(e){a.setCenter(e,!1)}),k=!0,F=!0}}else{var e=document.getElementById("selectedRouteMap");a.setMap(e),a.setDirectionService(L),k=!0}P.selectedPage="Route",W()}else if("Route"===P.selectedPage)P.selectedPage="Vehicles",z();else{if(void 0===P.selectedRoute&&G===!1){var t=document.getElementById("selectedSummaryMap");a.setSecondMap(t),G=!0}else if(G===!1){var t=document.getElementById("selectedSummaryMap");a.setSecondMap(t),a.setSecondDirectionService(L),a.setDirectionsForSecondMap(function(e){a.setCenter(e,!0)}),G=!0}P.selectedPage="Summary",j()}}function y(e){return void 0===e||e.length<1?!1:!0}function D(e){if(void 0===e||""===e)return!1;var t,n=[31,29,31,30,31,30,31,31,30,31,30,31],r=e.split(".");t=parseInt(0==r[0][0]?r[1][1]:r[1]);var i;return i=parseInt(0==r[1][0]?r[1][1]:r[1]),3===r.length&&2===r[0].length&&2===r[1].length&&4===r[2].length?1>t||t>n[i-1]||1>i||i>12?!1:!0:!1}function T(e,t){var n,r=e.split("."),i=t.split(".");n=parseInt(0==r[0][0]?r[0][1]:r[0]);var o;o=parseInt(0==i[0][0]?i[0][1]:i[0]);var a;a=parseInt(0==r[1][0]?r[1][1]:r[1]);var l;l=parseInt(0==i[1][0]?i[1][1]:i[1]);var s=parseInt(r[2]),c=parseInt(i[2]);return s>c?!1:s===c&&a>l?!1:s===c&&a===l&&n>o?!1:!0}function V(e){return void 0!==P.selectedRoute?!0:!1}function I(){if(!y(P.tourName)||!V(P.selectedRoute))return!1;if(P.selectedTourSeries){if(!D(P.tourSeriesStartDate))return!1;if(!B)return!1;if(!D(P.tourSeriesEndDate))return!1;if(!A)return!1;if(!T(P.tourSeriesStartDate,P.tourSeriesEndDate))return!1}else if(!D(P.tourStartDate))return!1;return!0}function C(){if(I()){if(P.selectedTourSeries)if(o.update)var e={Id:P.tour.TourSeries.Id,Name:P.tourName,StartDate:t.convertGermanDateStringToDate(P.tourSeriesStartDate),EndDate:t.convertGermanDateStringToDate(P.tourSeriesEndDate),DaysInterval:P.tourSeriesInterval,RouteId:P.selectedRoute.Id},n={Id:P.tour.Id,Name:P.tourName,Done:P.selectedDone,RouteId:P.selectedRoute.Id};else var e={Id:0,Name:P.tourName,StartDate:t.convertGermanDateStringToDate(P.tourSeriesStartDate),EndDate:t.convertGermanDateStringToDate(P.tourSeriesEndDate),DaysInterval:P.tourSeriesInterval,RouteId:P.selectedRoute.Id},n={Id:0,Name:P.tourName,Done:P.selectedDone,RouteId:P.selectedRoute.Id};else{var e=null;if(o.update)var n={Id:P.tour.Id,Name:P.tourName,StartDate:t.convertGermanDateStringToDate(P.tourStartDate),Done:P.selectedDone,RouteId:P.selectedRoute.Id};else var n={Id:0,Name:P.tourName,StartDate:t.convertGermanDateStringToDate(P.tourStartDate),Done:P.selectedDone,RouteId:P.selectedRoute.Id}}return t.createAndUpdateTour(n,e,x)}B?A?swal("Konnte nicht gespeichert werden!","Es müssen alle Eingabefelder ausgefüllt sein und eine Route ausgewählt sein.","error"):swal("Konnte nicht gespeichert werden!","Das Format des Enddatums stimmt nicht (dd.mm.yyyy)","error"):swal("Konnte nicht gespeichert werden!","Das Format des Startdatums stimmt nicht (dd.mm.yyyy)","error")}function R(){E=N.test(P.tourStartDate),E||swal("Fehlerhafte Eingabe","Das eingegebene Datum stimmt nicht mit den Format (dd.mm.yyyy) überein.","error")}function b(){B=N.test(P.tourSeriesStartDate),B||swal("Fehlerhafte Eingabe","Das eingegebene Datum stimmt nicht mit den Format (dd.mm.yyyy) überein.","error")}function M(){A=N.test(P.tourSeriesEndDate),A||swal("Fehlerhafte Eingabe","Das eingegebene Datum stimmt nicht mit den Format (dd.mm.yyyy) überein.","error")}var P=this;P.tour=t.getTour(),P.selectedPage="General",P.showGeneralPage=!0,P.showRoutePage=!1,P.showVehiclesPage=!1,P.showSummaryPage=!1,P.selectPage=v,P.selectPrevPage=w,P.selectNextPage=S,P.selectedTourSeries=!1,P.selectTourSeries=p,P.tourName="",P.tourStartDate="",P.tourSeriesStartDate="",P.tourSeriesEndDate="",P.tourSeriesInterval="",P.selectedDone=!1,P.selectDone=m,P.validateTourDate=R,P.validateTourSeriesStartDate=b,P.validateTourSeriesEndDate=M;var N=/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)\d\d$/,B=!0,A=!0,E=!0,k=!1,G=!1,L=!1,F=!1;P.allRoutes=r,P.selectedRoute=void 0,P.selectRoute=f,P.selectedRouteIndex=void 0,P.getIfSelected=u;var x=[];P.tourVehicles=[],P.allVehicles=n,P.orderByField="Kennzeichen",P.reverseSort=!1,P.checkVehicle=g,P.checkedVehicle=h,P.saveTour=C,P.getCompletedValue=d,P.selectedTourPrevVehicle=s,P.selectedTourNextVehicle=c;var O=0;o.update&&("Touren"===o.tourOrSeries||"Tourserien"===o.tourOrSeries)&&(P.tourName=P.tour.Name,document.getElementById("tourSeriesCheckbox").disabled=!0,"Touren"==o.tourOrSeries?(P.selectedTourSeries=!1,P.tourStartDate=t.convertDateToGermanDateString(P.tour.StartDate),P.selectedDone=P.tour.Done,$("#tourSeriesCheckbox").attr("disabled",!0)):(P.selectedTourSeries=!0,P.tourSeriesStartDate=t.convertDateToGermanDateString(P.tour.TourSeries.StartDate),P.tourSeriesEndDate=t.convertDateToGermanDateString(P.tour.TourSeries.EndDate),P.tourSeriesInterval=P.tour.TourSeries.DaysInterval),f(P.tour.Route),x=[],P.tourVehicles=[],angular.forEach(P.tour.TourVehicles,function(e){g(e.Vehicle)}),l());var U=function(){P.selectedPage="General",P.showGeneralPage=!0,P.showRoutePage=!1,P.showVehiclesPage=!1,P.showSummaryPage=!1},W=function(){P.selectedPage="Route",P.showGeneralPage=!1,P.showRoutePage=!0,P.showVehiclesPage=!1,P.showSummaryPage=!1},z=function(){P.selectedPage="Vehicles",P.showGeneralPage=!1,P.showRoutePage=!1,P.showVehiclesPage=!0,P.showSummaryPage=!1},j=function(){P.selectedPage="Summary",P.showGeneralPage=!1,P.showRoutePage=!1,P.showVehiclesPage=!1,P.showSummaryPage=!0};$(document).ready(function(){$.fn.datepicker.dates.de={days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],daysShort:["So","Mo","Di","Mi","Do","Fr","Sa"],daysMin:["So","Mo","Di","´Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthsShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],today:"Heute",clear:"Löschen",format:"dd.mm.yyyy",titleFormat:"MM yyyy",weekStart:1};var e={autoclose:!0,clearBtn:!0,language:"de"};$("#datepickerStartDate").datepicker(e).datepicker("setDate",new Date),$("#datepickerFrom").datepicker(e).datepicker("setDate",new Date),$("#datepickerTo").datepicker(e).datepicker("setDate",new Date)})}angular.module("app").controller("CreateAndUpdateTourController",e),e.$inject=["$location","TourService","allVehicles","allRoutes","$cookies","$routeParams","TourAndRouteGoogleAbstractService"]}(),function(){"use strict";function e(e,t,n,r,i,o){function a(){0===I?I=v.selectedTour.TourVehicles.length-1:I>0&&I--,v.currentVehicle=v.selectedTour.TourVehicles[I].Vehicle.RegistrationNumber+" - "+v.selectedTour.TourVehicles[I].Vehicle.VehicleType.Name}function l(){I<v.selectedTour.TourVehicles.length-1?I++:I===v.selectedTour.TourVehicles.length-1&&(I=0),v.currentVehicle=v.selectedTour.TourVehicles[I].Vehicle.RegistrationNumber+" - "+v.selectedTour.TourVehicles[I].Vehicle.VehicleType.Name}function s(e){return _.isUndefined(v.selectedTour)?"":e==v.selectedTour.Id?"selected":void 0}function c(){return n.getTour()}function u(){_.isNull(c())||("Touren"==v.tourOrSeriesFilter?n.deleteTourById(c().Id):n.deleteTourSeriesById(c().TourSeriesId))}function d(e){return n.convertDateToGermanDateString(e)}function h(e){return _.isUndefined(e)||_.isNull(e)?void 0:1==e?"Ja":0==e?"Nein":void 0}function g(){if(S=w.test(v.dateFrom),y=w.test(v.dateTo),S&&y){var e=n.convertGermanDateStringToDate(v.dateFrom),t=n.convertGermanDateStringToDate(v.dateTo);n.fetchAllToursByDateRange(e,t).then(function(e){v.allToursByDateRange=e,angular.forEach(v.allToursByDateRange,function(e){null!==e.TourSeries&&D.indexOf(e.TourSeries.Id)<0&&(v.allTourSeriesByDateRange.push(e),D.push(e.TourSeries.Id))})})}else swal("Fehlerhafte Eingabe","Das eingegebene Datum stimmt nicht mit den Format (dd.mm.yyyy) überein.","error")}function f(e){v.selectedTour=e,0===v.selectedTour.TourVehicles.length?v.currentVehicle="Keine Fahrzeuge zugeordnet!":(v.currentVehicle=v.selectedTour.TourVehicles[0].Vehicle.RegistrationNumber+" - "+v.selectedTour.TourVehicles[I].Vehicle.VehicleType.Name,I=0);var t=e.Route.Waypoints,r=[];angular.forEach(t,function(e){r.push({location:e.Name})}),o.buildRouteObject(e.Route.StartName,e.Route.DestinationName,r),n.setTour(e),i.putObject("selectedTour",e),o.setDirectionsWithoutCallback()}function p(){v.selectedTour&&e.path("/TourManagement/createAndUpdateTour/true/"+v.tourOrSeriesFilter)}function m(e){v.tourOrSeriesFilter=e,angular.forEach(v.allToursByDateRange,function(e){null!==e.TourSeries&&D.indexOf(e.TourSeries.Id)<0&&(v.allTourSeriesByDateRange.push(e),D.push(e.TourSeries.Id))})}var v=this;v.allToursByDateRange=r,v.allTourSeriesByDateRange=[];var w=/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)\d\d$/,S=!0,y=!0,D=[],T=document.getElementById("selectedTourMap"),V=!1;o.setMap(T),o.setDirectionService(V),v.getCompletedValue=h,v.getDataValue=d,v.deleteTour=u,v.getSelectedTour=c,v.orderToursFieldBy="Name",v.reverseSort=!1,v.tourOrSeriesFilter="Touren",v.selectTourOrSeries=m,v.selectedTour=void 0,v.selectTour=f,v.dateFrom=n.convertDateToGermanDateString(new Date),v.dateTo=n.convertDateToGermanDateString(new Date),v.getIfSelected=s,v.filter=g,v.updateTour=p;var I=0;v.currentVehicle="Keine Tour ausgewählt!",v.selectedTourPrevVehicle=a,v.selectedTourNextVehicle=l,$(document).ready(function(){$.fn.datepicker.dates.de={days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],daysShort:["So","Mo","Di","Mi","Do","Fr","Sa"],daysMin:["So","Mo","Di","´Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthsShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],today:"Heute",clear:"Löschen",format:"dd.mm.yyyy",titleFormat:"MM yyyy",weekStart:1};var e={autoclose:!0,clearBtn:!0,language:"de",startDate:"01/01/2015",endDate:"+5y"};$("#datepickerFrom").datepicker(e).datepicker("setDate",new Date),$("#datepickerTo").datepicker(e).datepicker("setDate",new Date)})}angular.module("app").controller("ShowAllToursController",e),e.$inject=["$location","$scope","TourService","allToursByDateRange","$cookies","TourAndRouteGoogleAbstractService"]}(),function(){"use strict";function e(e,t,n,r,i){function o(e){t.fetchVehicleWithRegistrationNumber(e).then(function(){var e=t.getVehicleWithRegistrationNumber();d.vehicleAlreadyExists=_.isNull(e)||_.isUndefined(e)?!1:!0})}function a(){if(1==d.vehicleAlreadyExists)return void swal("Das aktuelle Kennzeichen ist bereits vergeben!","","error");if(void 0===d.selectedVehicleType)return void swal("Der Fahrzeugtyp muss angegeben werden!","","error");if(void 0===d.vehicle.RegistrationNumber)return void swal("Das Kennzeichen muss angegeben werden!","","error");var e={VehicleTypeId:d.selectedVehicleType.Id,RegistrationNumber:d.vehicle.RegistrationNumber,Properties:d.allProperties};t.createVehicle(e).then(function(e){if(void 0!==e||null!==e){var t=d.allProperties;d.vehicle=e,d.vehicle.Properties=t,swal("Erfolgreich gespeichert!","","success"),i.path("/VehicleManagement/")}else swal("Interner Serverfehler!","","error")})}function l(e){d.vehicle.Picture=e,document.getElementById("canvasContainer").className="hidden"}function s(){d.vehicle.Picture=void 0}function c(){return r.getAllProperties().then(function(e){d.allProperties=e})}function u(e){return n.getAllVehicleTypePropertiesByVehicleTypeId(e).then(function(e){d.vehicletypeProperties=e})}var d=this;d.allVehicleTypes=e,d.selectedVehicleType=void 0,d.allProperties={},d.vehicle={},d.vehicleAlreadyExists=!1,d.createVehicle=a,d.getAllVehicleTypePropertiesByVehicleTypeId=u,d.getAllProperties=c,d.createPicture=l,d.discardPicture=s,d.vehicleWithRegistrationNumberExists=o}angular.module("app").controller("CreateVehicleController",e),e.$inject=["allVehicleTypes","VehicleService","VehicleTypeService","PropertyService","$location"]}(),function(){"use strict";function e(e,t){function n(n){e.setVehicle(n),e.fetchAllVehiclePropertiesByVehicleId(n.Id).then(function(n){e.setVehicleProperties(n),t.path("/VehicleManagement/showVehicle")})}var r=this;r.filter={id:""},r.orderByField="Kennzeichen",r.reverseSort=!1,r.allVehicles=e.getAllVehicles(),r.selectVehicle=n}angular.module("app").controller("ShowAllVehiclesController",e),e.$inject=["VehicleService","$location"]}(),function(){"use strict";function e(e,t,n){function r(){e.setVehicleTypeId(o.vehicle.VehicleTypeId),t.path("/VehicleManagement/updateVehicle")}function i(){return e.deleteVehicleById(o.vehicle.Id)}var o=this;o.vehicle=e.getVehicle(),n.putObject("selectedVehicle",{Id:o.vehicle.Id,VehicleTypeId:o.vehicle.VehicleTypeId,RegistrationNumber:o.vehicle.RegistrationNumber,VehicleType:o.vehicle.VehicleType,Properties:o.vehicle.Properties}),o.editVehicle=r,o.deleteVehicleById=i}angular.module("app").controller("ShowVehicleController",e),e.$inject=["VehicleService","$location","$cookies"]}(),function(){"use strict";function e(e,t,n){function r(e){t.fetchVehicleWithRegistrationNumber(e).then(function(){var e=t.getVehicleWithRegistrationNumber();c.vehicleAlreadyExists=_.isNull(e)||_.isUndefined(e)||c.vehicle.Id==e.Id?!1:!0})}function i(e){return c.vehicle.Picture=e,t.savePicture(c.vehicle).then(function(){document.getElementById("canvasContainer").className="hidden"})}function o(){c.vehicle.Picture=void 0}function a(){c.vehicle=c.vehicleBeforeEdit,n.path("/VehicleManagement")}function l(){if(1==c.vehicleAlreadyExists)return void swal("Das aktuelle Kennzeichen ist bereits vergeben!","","error");for(var e=0;e<c.vehicle.Properties.length;e++)_.isEmpty(c.vehicle.Properties[e].Value)&&(c.vehicle.Properties[e].Value=0);console.log(c.vehicle),t.setVehicleTypeId(c.selectedVehicleType.Id),t.updateVehicle(c.vehicle).then(function(e){if(void 0!==e||null!==e){var r=c.vehicle.Properties;t.setVehicle(e),t.setVehicleProperties(r),c.vehicle=t.getVehicle(),swal("Erfolgreich gespeichert!","","success"),n.path("/VehicleManagement/showVehicle")}else swal("Interner Serverfehler!","","error")})}function s(){return t.deleteVehicleById(c.vehicle.Id).then(function(){t.setVehicle({})})}var c=this;c.filter={id:""},c.orderByField="Kennzeichen",c.reverseSort=!1,c.allVehicleTypes=e,c.vehicletypeProperties={},c.allProperties={},c.vehicle=t.getVehicle(),c.vehicleBeforeEdit=angular.copy(c.vehicle),c.selectedVehicleType=_.find(e,{Id:c.vehicle.VehicleTypeId}),c.vehicleAlreadyExists=!1,c.deleteVehicleById=s,c.updateVehicle=l,c.createPicture=i,c.discardPicture=o,c.discardUpdate=a,c.vehicleWithRegistrationNumberExists=r}angular.module("app").controller("UpdateVehicleController",e),e.$inject=["allVehicleTypes","VehicleService","$location"]}();